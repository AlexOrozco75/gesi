<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Estacionamiento Central</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            background-image: radial-gradient(circle at 50% 50%, #1e293b 0%, #0f172a 100%);
        }

        /* Contenedor con efecto asfalto */
        .parking-map-container {
            background-color: #1a1a1a;
            border: 2px solid #333;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), inset 0 0 40px rgba(0,0,0,0.8);
            background-image: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23333' fill-opacity='0.4' fill-rule='evenodd'%3E%3Cpath d='M0 38.59l2.83-2.83 1.41 1.41L1.41 40H0v-1.41zM0 1.4l2.83 2.83 1.41-1.41L1.41 0H0v1.41zM38.59 40l-2.83-2.83 1.41-1.41L40 38.59V40h-1.41zM40 1.41l-2.83 2.83-1.41-1.41L38.59 0H40v1.41zM20 18.6l2.83-2.83 1.41 1.41L21.41 20l2.83 2.83-1.41 1.41L20 21.41l-2.83 2.83-1.41-1.41L18.59 20l-2.83-2.83 1.41-1.41L20 18.59z'/%3E%3C/g%3E%3C/svg%3E");
        }

        /* Estilo base del caj√≥n */
        .parking-space {
            position: relative;
            min-height: 140px;
            border-left: 2px dashed rgba(255, 255, 255, 0.3);
            border-right: 2px dashed rgba(255, 255, 255, 0.3);
            border-bottom: 4px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.02);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(2px);
        }

        /* Estados con brillos de ne√≥n */
        .parking-space.free {
            border-bottom-color: #22c55e;
            box-shadow: inset 0 -10px 20px rgba(34, 197, 94, 0.2);
        }
        
        .parking-space.occupied {
            border-bottom-color: #ef4444;
            box-shadow: inset 0 -10px 20px rgba(239, 68, 68, 0.2);
        }

        .parking-space.maintenance {
            border-bottom-color: #eab308;
            box-shadow: inset 0 -10px 20px rgba(234, 179, 8, 0.2);
        }

        .parking-space:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.05);
        }

        /* Animaci√≥n del icono */
        .status-icon {
            font-size: 3.5rem;
            filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));
            transition: transform 0.3s;
        }

        .parking-space:hover .status-icon {
            transform: scale(1.1);
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Grid Responsivo Inteligente */
        #parkingMap {
            display: grid;
            /* Esto crea columnas autom√°ticas: m√≠nimo 100px de ancho, m√°ximo lo que quepa */
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); 
            gap: 1rem;
            width: 100%;
        }
    </style>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBQsED9726WvSbkUs3dhRLSZh2QqlRmaIE",
            authDomain: "estacionamientoitc.firebaseapp.com",
            databaseURL: "https://estacionamientoitc-default-rtdb.firebaseio.com",
            projectId: "estacionamientoitc",
            storageBucket: "estacionamientoitc.firebasestorage.app",
            messagingSenderId: "38266365378",
            appId: "1:38266365378:web:9a3c9a726fcb1eb845a25b",
            measurementId: "G-6P8X0N8E4J"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth(app);
        
        signInAnonymously(auth)
            .then(() => console.log('‚úÖ Conectado al sistema'))
            .catch((error) => console.error('‚ùå Error de conexi√≥n:', error));

        const parkingRef = ref(database, 'parking');
        const parkingMap = document.getElementById('parkingMap');

        function createParkingSpaceElement(id, status) {
            const spaceElement = document.createElement('div');
            spaceElement.id = `space${id}`;
            // Clases base + flexbox para centrar contenido
            spaceElement.className = 'parking-space rounded-lg flex flex-col items-center justify-center p-2 cursor-default';

            const statusInfo = document.createElement('span');
            statusInfo.className = 'status-info';

            const spaceLabel = document.createElement('div');
            spaceLabel.className = 'absolute top-2 left-2 text-xs font-bold text-gray-500 bg-gray-900/80 px-2 py-0.5 rounded';
            spaceLabel.textContent = `P-${id}`;

            let statusTextClass = "text-gray-400";
            let statusLabel = status || '---';

            switch (status) {
                case 'Libre':
                    spaceElement.classList.add('free');
                    statusInfo.innerHTML = 'üü¢'; 
                    statusTextClass = "text-green-400 font-bold";
                    break;
                case 'Ocupado':
                    spaceElement.classList.add('occupied');
                    statusInfo.innerHTML = 'üöó'; // Cambi√© el c√≠rculo rojo por un coche para m√°s estilo
                    statusTextClass = "text-red-400 font-bold";
                    break;
                case 'Mantenimiento':
                    spaceElement.classList.add('maintenance');
                    statusInfo.innerHTML = 'üöß';
                    statusTextClass = "text-yellow-400 font-bold";
                    break;
                default:
                    spaceElement.classList.add('unknown');
                    statusInfo.innerHTML = '‚ùì';
            }
            
            spaceElement.innerHTML = `
                <div class="status-icon mb-1">${statusInfo.innerHTML}</div>
                <span class="text-sm uppercase tracking-wider ${statusTextClass}">${statusLabel}</span>
            `;
            spaceElement.appendChild(spaceLabel);
            return spaceElement;
        }

        onValue(parkingRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
                // Actualizar contadores con animaci√≥n simple
                updateCounter('freeSpaces', data.free_spaces || 0);
                updateCounter('occupiedSpaces', data.occupied_spaces || 0);
                updateCounter('totalSpaces', data.total_spaces || 0);

                parkingMap.innerHTML = '';
                if (data.spaces) {
                    const spaceIds = Object.keys(data.spaces).sort((a, b) => parseInt(a) - parseInt(b));
                    spaceIds.forEach(id => {
                        const status = data.spaces[id].status;
                        const spaceElement = createParkingSpaceElement(id, status);
                        parkingMap.appendChild(spaceElement);
                    });
                }
                
                // Actualizar timestamp
                const anySpace = data.spaces && data.spaces[Object.keys(data.spaces)[0]];
                const lastUpdated = anySpace && anySpace.last_updated;
                if (lastUpdated) {
                    document.getElementById('lastUpdate').textContent = new Date(lastUpdated).toLocaleString('es-MX', {
                        hour: '2-digit', minute: '2-digit', hour12: true
                    });
                    document.getElementById('statusMessage').classList.remove('hidden');
                    document.getElementById('statusMessage').classList.add('animate-pulse');
                }
            }
        });

        // Funci√≥n helper para animar n√∫meros (opcional pero est√©tico)
        function updateCounter(id, newValue) {
            const el = document.getElementById(id);
            el.textContent = newValue;
        }
        
        // Evitar memory leaks en desconexi√≥n (opcional en web, bueno para pr√°cticas)
        // parkingRef.onDisconnect().remove(); // Cuidado: esto borrar√≠a datos al cerrar. Mejor lo quito para solo lectura.
    </script>
</head>
<body class="text-white min-h-screen pb-10">

    <nav class="w-full bg-slate-800/50 backdrop-blur-md border-b border-white/10 mb-8 sticky top-0 z-50">
        <div class="container mx-auto p-4 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <span class="text-2xl">‚ö°</span>
                <h1 class="text-xl md:text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-cyan-300">
                    Estacionamiento Central
                </h1>
            </div>
            <div class="text-xs md:text-sm text-gray-400">
                ITC Campus
            </div>
        </div>
    </nav>

    <div class="container mx-auto px-4 md:px-6">
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            <div class="glass-card p-6 rounded-2xl shadow-lg transform hover:-translate-y-1 transition duration-300 border-l-4 border-green-500">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-gray-400 text-sm font-medium uppercase tracking-wider">Disponibles</p>
                        <span id="freeSpaces" class="text-5xl font-bold text-white mt-2 block">0</span>
                    </div>
                    <div class="h-12 w-12 rounded-full bg-green-500/20 flex items-center justify-center text-2xl">
                        P
                    </div>
                </div>
            </div>

            <div class="glass-card p-6 rounded-2xl shadow-lg transform hover:-translate-y-1 transition duration-300 border-l-4 border-red-500">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-gray-400 text-sm font-medium uppercase tracking-wider">Ocupados</p>
                        <span id="occupiedSpaces" class="text-5xl font-bold text-white mt-2 block">0</span>
                    </div>
                    <div class="h-12 w-12 rounded-full bg-red-500/20 flex items-center justify-center text-2xl">
                        üöó
                    </div>
                </div>
            </div>

            <div class="glass-card p-6 rounded-2xl shadow-lg transform hover:-translate-y-1 transition duration-300 border-l-4 border-blue-500">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-gray-400 text-sm font-medium uppercase tracking-wider">Capacidad</p>
                        <span id="totalSpaces" class="text-5xl font-bold text-white mt-2 block">0</span>
                    </div>
                    <div class="h-12 w-12 rounded-full bg-blue-500/20 flex items-center justify-center text-2xl">
                        üìä
                    </div>
                </div>
            </div>
        </div>

        <div class="parking-map-container rounded-xl p-6 md:p-8 mb-10 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-blue-500 to-transparent opacity-50"></div>
            
            <div class="flex justify-between items-end mb-6">
                <h3 class="text-2xl font-bold text-white flex items-center gap-2">
                    <span class="w-2 h-8 bg-blue-500 rounded-full inline-block"></span>
                    Planta Baja
                </h3>
                <div id="statusMessage" class="text-xs text-blue-300 bg-blue-900/30 px-3 py-1 rounded-full hidden border border-blue-500/30">
                    ‚è± Actualizado: <span id="lastUpdate" class="font-mono">--:--</span>
                </div>
            </div>

            <div id="parkingMap">
                </div>
        </div>

        <div class="flex flex-wrap justify-center gap-4 text-sm text-gray-400 mb-8">
            <div class="flex items-center gap-2 bg-gray-800/50 px-4 py-2 rounded-full border border-white/5">
                <span class="w-3 h-3 rounded-full bg-green-500 shadow-[0_0_10px_#22c55e]"></span> Libre
            </div>
            <div class="flex items-center gap-2 bg-gray-800/50 px-4 py-2 rounded-full border border-white/5">
                <span class="w-3 h-3 rounded-full bg-red-500 shadow-[0_0_10px_#ef4444]"></span> Ocupado
            </div>
            <div class="flex items-center gap-2 bg-gray-800/50 px-4 py-2 rounded-full border border-white/5">
                <span class="w-3 h-3 rounded-full bg-yellow-500 shadow-[0_0_10px_#eab308]"></span> Mantenimiento
            </div>
        </div>
        
    </div>
</body>
</html>